"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _chai = _interopRequireDefault(require("chai"));

var _chaiAsPromised = _interopRequireDefault(require("chai-as-promised"));

var _2 = _interopRequireWildcard(require("../.."));

var _imageElement = require("../../lib/basedriver/image-element");

var _constants = require("../../lib/constants");

var _sinon = _interopRequireDefault(require("sinon"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

_chai.default.should();

_chai.default.use(_chaiAsPromised.default);

const defRect = {
  x: 100,
  y: 110,
  width: 50,
  height: 25
};
const defTemplate = 'iVBORasdf';
describe('ImageElement', function () {
  const driver = new _2.default();
  describe('.size', function () {
    it('should return the width and height of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.size.should.eql({
        width: defRect.width,
        height: defRect.height
      });
    });
  });
  describe('.location', function () {
    it('should return the location of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.location.should.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
  });
  describe('.center', function () {
    it('should return the center location of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.center.should.eql({
        x: defRect.x + defRect.width / 2,
        y: defRect.y + defRect.height / 2
      });
    });
  });
  describe('.asElement', function () {
    it('should get the webdriver object representation of the element', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.asElement('ELEMENT').ELEMENT.should.match(/^appium-image-el/);
    });
  });
  describe('.equals', function () {
    it('should say two image elements with same rect are equal', function () {
      const el1 = new _2.ImageElement('foo', defRect);
      const el2 = new _2.ImageElement('bar', defRect);
      el1.equals(el2).should.be.true;
      el2.equals(el1).should.be.true;
    });
    it('should say two image elements with different rect are not equal', function () {
      const el1 = new _2.ImageElement(defTemplate, { ...defRect,
        x: 0
      });
      const el2 = new _2.ImageElement(defTemplate, defRect);
      el1.equals(el2).should.be.false;
      el2.equals(el1).should.be.false;
    });
  });
  describe('.click', function () {
    it('should reject an invalid tap strategy', async function () {
      const d = new _2.default();
      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        imageElementTapStrategy: 'bad'
      });
      await el.click(d).should.eventually.be.rejectedWith(/Incorrect imageElementTapStrategy/);
    });
    it('should try to check for image element staleness, and throw if stale', async function () {
      const d = new _2.default();

      _sinon.default.stub(d, 'findByImage').throws();

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: true,
        autoUpdateImageElementPosition: false
      });
      await el.click(d).should.eventually.be.rejectedWith(/no longer attached/);
      await d.settings.update({
        checkForImageElementStaleness: false,
        autoUpdateImageElementPosition: true
      });
      await el.click(d).should.eventually.be.rejectedWith(/no longer attached/);
    });
    it('should auto-update element position if requested', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      _sinon.default.stub(d, 'performActions');

      const el = new _2.ImageElement(defTemplate, defRect);
      const newRect = { ...defRect,
        x: defRect.x + 10,
        y: defRect.y + 5
      };
      const elPos2 = new _2.ImageElement(defTemplate, newRect);

      _sinon.default.stub(d, 'findByImage').returns(elPos2);

      await d.settings.update({
        autoUpdateImageElementPosition: true
      });
      el.rect.should.not.eql(newRect);
      await el.click(d);
      el.rect.should.eql(newRect);
    });
    it('should tap the center of an element using w3c actions by default', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      const actionStub = _sinon.default.stub(d, 'performActions');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d);
      const pointerMoveAction = actionStub.args[0][0][0].actions[0];
      pointerMoveAction.x.should.equal(el.center.x);
      pointerMoveAction.y.should.equal(el.center.y);
    });
    it('should fall back to touchactions if w3c actions do not exist on driver', async function () {
      const d = new _2.default();
      d.performTouch = _lodash.default.noop;

      const actionStub = _sinon.default.stub(d, 'performTouch');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d);
      const action = actionStub.args[0][0][0].options;
      action.x.should.equal(el.center.x);
      action.y.should.equal(el.center.y);
    });
    it('should use touchactions if requested', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      const w3cStub = _sinon.default.stub(d, 'performActions');

      d.performTouch = _lodash.default.noop;

      const touchStub = _sinon.default.stub(d, 'performTouch');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false,
        imageElementTapStrategy: 'touchActions'
      });
      await el.click(d);
      const action = touchStub.args[0][0][0].options;
      action.x.should.equal(el.center.x);
      action.y.should.equal(el.center.y);
      w3cStub.callCount.should.eql(0);
    });
    it('should throw if driver does not implement any type of action', async function () {
      const d = new _2.default();
      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d).should.eventually.be.rejectedWith(/did not implement/);
    });
  });
  describe('#execute', function () {
    const imgEl = new _2.ImageElement(defTemplate, defRect, 0, 'aGFwcHkgdGVzdGluZw==');

    const clickStub = _sinon.default.stub(imgEl, 'click');

    before(function () {
      driver._imgElCache.set(imgEl.id, imgEl);

      clickStub.returns(true);
    });
    after(function () {
      driver._imgElCache.reset();

      clickStub.restore();
    });
    it('should reject executions on elements not in the cache', async function () {
      await _2.ImageElement.execute(driver, 'click', 'appium-image-element-foo').should.eventually.be.rejectedWith(/element could not be located/);
    });
    it('should reject executions for unsupported commands', async function () {
      await _2.ImageElement.execute(driver, 'foobar', imgEl.id).should.eventually.be.rejectedWith(/not yet been implemented/);
    });
    it('should get displayed status of element', async function () {
      await _2.ImageElement.execute(driver, 'elementDisplayed', imgEl.id).should.eventually.be.true;
    });
    it('should get size of element', async function () {
      await _2.ImageElement.execute(driver, 'getSize', imgEl.id).should.eventually.eql({
        width: defRect.width,
        height: defRect.height
      });
    });
    it('should get location of element', async function () {
      await _2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
    it('should get location in view of element', async function () {
      await _2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
    it('should get rect of element', async function () {
      await _2.ImageElement.execute(driver, 'getElementRect', imgEl.id).should.eventually.eql(defRect);
    });
    it('should get score of element', async function () {
      await _2.ImageElement.execute(driver, 'getAttribute', imgEl.id, 'score').should.eventually.eql(0);
    });
    it('should get visual of element', async function () {
      await _2.ImageElement.execute(driver, 'getAttribute', imgEl.id, 'visual').should.eventually.eql('aGFwcHkgdGVzdGluZw==');
    });
    it('should get null as visual of element by default', async function () {
      const imgElement = new _2.ImageElement(defTemplate, defRect);

      driver._imgElCache.set(imgElement.id, imgElement);

      await _2.ImageElement.execute(driver, 'getAttribute', imgElement.id, 'visual').should.eventually.eql(null);
    });
    it('should not get other attribute', async function () {
      await _2.ImageElement.execute(driver, 'getAttribute', imgEl.id, 'content-desc').should.eventually.rejectedWith('Method has not yet been implemented');
    });
    it('should click element', async function () {
      await _2.ImageElement.execute(driver, 'click', imgEl.id).should.eventually.be.true;
    });
  });
});
describe('image element LRU cache', function () {
  it('should accept and cache image elements', function () {
    const el1 = new _2.ImageElement(defTemplate, defRect);
    const el2 = new _2.ImageElement(defTemplate, defRect);
    const cache = (0, _imageElement.makeImageElementCache)();
    cache.set(el1.id, el1);
    el1.equals(cache.get(el1.id)).should.be.true;
    _lodash.default.isUndefined(cache.get(el2.id)).should.be.true;
    cache.has(el1.id).should.be.true;
    cache.has(el2.id).should.be.false;
  });
  it('once cache reaches max size, should eject image elements', function () {
    const el1 = new _2.ImageElement(defTemplate, defRect);
    const el2 = new _2.ImageElement(defTemplate, defRect);
    const cache = (0, _imageElement.makeImageElementCache)(defTemplate.length + 1);
    cache.set(el1.id, el1);
    cache.has(el1.id).should.be.true;
    cache.set(el2.id, el2);
    cache.has(el2.id).should.be.true;
    cache.has(el1.id).should.be.false;
  });
});
describe('getImgElFromArgs', function () {
  it('should return the image element id from json obj in args', function () {
    const imgEl = `${_constants.IMAGE_ELEMENT_PREFIX}foo`;
    const args = [1, 'foo', imgEl];
    (0, _imageElement.getImgElFromArgs)(args).should.eql(imgEl);
  });
  it('should not return anything if image element id not in args', function () {
    const args = [1, 'foo'];
    _lodash.default.isUndefined((0, _imageElement.getImgElFromArgs)(args)).should.be.true;
  });
  it('should not find image element id in anything but prefix', function () {
    const notImgEl = `foo${_constants.IMAGE_ELEMENT_PREFIX}`;
    const args = [1, 'foo', notImgEl];
    _lodash.default.isUndefined((0, _imageElement.getImgElFromArgs)(args)).should.be.true;
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvYmFzZWRyaXZlci9pbWFnZS1lbGVtZW50LXNwZWNzLmpzIl0sIm5hbWVzIjpbImNoYWkiLCJzaG91bGQiLCJ1c2UiLCJjaGFpQXNQcm9taXNlZCIsImRlZlJlY3QiLCJ4IiwieSIsIndpZHRoIiwiaGVpZ2h0IiwiZGVmVGVtcGxhdGUiLCJkZXNjcmliZSIsImRyaXZlciIsIkJhc2VEcml2ZXIiLCJpdCIsImVsIiwiSW1hZ2VFbGVtZW50Iiwic2l6ZSIsImVxbCIsImxvY2F0aW9uIiwiY2VudGVyIiwiYXNFbGVtZW50IiwiRUxFTUVOVCIsIm1hdGNoIiwiZWwxIiwiZWwyIiwiZXF1YWxzIiwiYmUiLCJ0cnVlIiwiZmFsc2UiLCJkIiwic2V0dGluZ3MiLCJ1cGRhdGUiLCJpbWFnZUVsZW1lbnRUYXBTdHJhdGVneSIsImNsaWNrIiwiZXZlbnR1YWxseSIsInJlamVjdGVkV2l0aCIsInNpbm9uIiwic3R1YiIsInRocm93cyIsImNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzIiwiYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uIiwicGVyZm9ybUFjdGlvbnMiLCJfIiwibm9vcCIsIm5ld1JlY3QiLCJlbFBvczIiLCJyZXR1cm5zIiwicmVjdCIsIm5vdCIsImFjdGlvblN0dWIiLCJwb2ludGVyTW92ZUFjdGlvbiIsImFyZ3MiLCJhY3Rpb25zIiwiZXF1YWwiLCJwZXJmb3JtVG91Y2giLCJhY3Rpb24iLCJvcHRpb25zIiwidzNjU3R1YiIsInRvdWNoU3R1YiIsImNhbGxDb3VudCIsImltZ0VsIiwiY2xpY2tTdHViIiwiYmVmb3JlIiwiX2ltZ0VsQ2FjaGUiLCJzZXQiLCJpZCIsImFmdGVyIiwicmVzZXQiLCJyZXN0b3JlIiwiZXhlY3V0ZSIsImltZ0VsZW1lbnQiLCJjYWNoZSIsImdldCIsImlzVW5kZWZpbmVkIiwiaGFzIiwibGVuZ3RoIiwiSU1BR0VfRUxFTUVOVF9QUkVGSVgiLCJub3RJbWdFbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7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S0FBbEM7QUFDRCxHQUpDLENBQUY7QUFLQS9DLEVBQUFBLEVBQUUsQ0FBQyw0REFBRCxFQUErRCxZQUFZO0FBQzNFLFVBQU1zQyxJQUFJLEdBQUcsQ0FBQyxDQUFELEVBQUksS0FBSixDQUFiO0FBQ0FULG9CQUFFK0IsV0FBRixDQUFjLG9DQUFpQnRCLElBQWpCLENBQWQsRUFBc0NsRCxNQUF0QyxDQUE2Q3lCLEVBQTdDLENBQWdEQyxJQUFoRDtBQUNELEdBSEMsQ0FBRjtBQUlBZCxFQUFBQSxFQUFFLENBQUMseURBQUQsRUFBNEQsWUFBWTtBQUN4RSxVQUFNZ0UsUUFBUSxHQUFJLE1BQUtELCtCQUFxQixFQUE1QztBQUNBLFVBQU16QixJQUFJLEdBQUcsQ0FBQyxDQUFELEVBQUksS0FBSixFQUFXMEIsUUFBWCxDQUFiO0FBQ0FuQyxvQkFBRStCLFdBQUYsQ0FBYyxvQ0FBaUJ0QixJQUFqQixDQUFkLEVBQXNDbEQsTUFBdEMsQ0FBNkN5QixFQUE3QyxDQUFnREMsSUFBaEQ7QUFDRCxHQUpDLENBQUY7QUFLRCxDQWZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgQmFzZURyaXZlciwgeyBJbWFnZUVsZW1lbnQgfSBmcm9tICcuLi8uLic7XG5pbXBvcnQgeyBtYWtlSW1hZ2VFbGVtZW50Q2FjaGUsIGdldEltZ0VsRnJvbUFyZ3MgfSBmcm9tICcuLi8uLi9saWIvYmFzZWRyaXZlci9pbWFnZS1lbGVtZW50JztcbmltcG9ydCB7IElNQUdFX0VMRU1FTlRfUFJFRklYIH0gZnJvbSAnLi4vLi4vbGliL2NvbnN0YW50cyc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuXG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cblxuY29uc3QgZGVmUmVjdCA9IHt4OiAxMDAsIHk6IDExMCwgd2lkdGg6IDUwLCBoZWlnaHQ6IDI1fTtcbmNvbnN0IGRlZlRlbXBsYXRlID0gJ2lWQk9SYXNkZic7XG5cbmRlc2NyaWJlKCdJbWFnZUVsZW1lbnQnLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGRyaXZlciA9IG5ldyBCYXNlRHJpdmVyKCk7XG5cbiAgZGVzY3JpYmUoJy5zaXplJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBpbWFnZSBlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5zaXplLnNob3VsZC5lcWwoe3dpZHRoOiBkZWZSZWN0LndpZHRoLCBoZWlnaHQ6IGRlZlJlY3QuaGVpZ2h0fSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcubG9jYXRpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGxvY2F0aW9uIG9mIHRoZSBpbWFnZSBlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5sb2NhdGlvbi5zaG91bGQuZXFsKHt4OiBkZWZSZWN0LngsIHk6IGRlZlJlY3QueX0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnLmNlbnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgY2VudGVyIGxvY2F0aW9uIG9mIHRoZSBpbWFnZSBlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5jZW50ZXIuc2hvdWxkLmVxbCh7XG4gICAgICAgIHg6IGRlZlJlY3QueCArIGRlZlJlY3Qud2lkdGggLyAyLFxuICAgICAgICB5OiBkZWZSZWN0LnkgKyBkZWZSZWN0LmhlaWdodCAvIDJcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnLmFzRWxlbWVudCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgd2ViZHJpdmVyIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGUgZWxlbWVudCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5hc0VsZW1lbnQoJ0VMRU1FTlQnKS5FTEVNRU5ULnNob3VsZC5tYXRjaCgvXmFwcGl1bS1pbWFnZS1lbC8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnLmVxdWFscycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHNheSB0d28gaW1hZ2UgZWxlbWVudHMgd2l0aCBzYW1lIHJlY3QgYXJlIGVxdWFsJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZWwxID0gbmV3IEltYWdlRWxlbWVudCgnZm9vJywgZGVmUmVjdCk7XG4gICAgICBjb25zdCBlbDIgPSBuZXcgSW1hZ2VFbGVtZW50KCdiYXInLCBkZWZSZWN0KTtcbiAgICAgIGVsMS5lcXVhbHMoZWwyKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIGVsMi5lcXVhbHMoZWwxKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHNheSB0d28gaW1hZ2UgZWxlbWVudHMgd2l0aCBkaWZmZXJlbnQgcmVjdCBhcmUgbm90IGVxdWFsJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZWwxID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgey4uLmRlZlJlY3QsIHg6IDB9KTtcbiAgICAgIGNvbnN0IGVsMiA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgZWwxLmVxdWFscyhlbDIpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAgIGVsMi5lcXVhbHMoZWwxKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcuY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgYW4gaW52YWxpZCB0YXAgc3RyYXRlZ3knLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7aW1hZ2VFbGVtZW50VGFwU3RyYXRlZ3k6ICdiYWQnfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL0luY29ycmVjdCBpbWFnZUVsZW1lbnRUYXBTdHJhdGVneS8pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdHJ5IHRvIGNoZWNrIGZvciBpbWFnZSBlbGVtZW50IHN0YWxlbmVzcywgYW5kIHRocm93IGlmIHN0YWxlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBzaW5vbi5zdHViKGQsICdmaW5kQnlJbWFnZScpLnRocm93cygpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIC8vIHdlIG5lZWQgdG8gY2hlY2sgZm9yIHN0YWxlbmVzcyBpZiBleHBsaWNpdGx5IHJlcXVlc3RlZCB0byBkbyBzb1xuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogdHJ1ZSxcbiAgICAgICAgYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL25vIGxvbmdlciBhdHRhY2hlZC8pO1xuXG4gICAgICAvLyBhbmQgYWxzbyBpZiB3ZSBhcmUgdXBkYXRpbmcgdGhlIGVsZW1lbnQgcG9zaXRpb25cbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IGZhbHNlLFxuICAgICAgICBhdXRvVXBkYXRlSW1hZ2VFbGVtZW50UG9zaXRpb246IHRydWVcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9ubyBsb25nZXIgYXR0YWNoZWQvKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGF1dG8tdXBkYXRlIGVsZW1lbnQgcG9zaXRpb24gaWYgcmVxdWVzdGVkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBkLnBlcmZvcm1BY3Rpb25zID0gXy5ub29wO1xuICAgICAgc2lub24uc3R1YihkLCAncGVyZm9ybUFjdGlvbnMnKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBjb25zdCBuZXdSZWN0ID0gey4uLmRlZlJlY3QsIHg6IGRlZlJlY3QueCArIDEwLCB5OiBkZWZSZWN0LnkgKyA1fTtcbiAgICAgIGNvbnN0IGVsUG9zMiA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIG5ld1JlY3QpO1xuICAgICAgc2lub24uc3R1YihkLCAnZmluZEJ5SW1hZ2UnKS5yZXR1cm5zKGVsUG9zMik7XG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGF1dG9VcGRhdGVJbWFnZUVsZW1lbnRQb3NpdGlvbjogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgZWwucmVjdC5zaG91bGQubm90LmVxbChuZXdSZWN0KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpO1xuICAgICAgZWwucmVjdC5zaG91bGQuZXFsKG5ld1JlY3QpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGFwIHRoZSBjZW50ZXIgb2YgYW4gZWxlbWVudCB1c2luZyB3M2MgYWN0aW9ucyBieSBkZWZhdWx0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBkLnBlcmZvcm1BY3Rpb25zID0gXy5ub29wO1xuICAgICAgY29uc3QgYWN0aW9uU3R1YiA9IHNpbm9uLnN0dWIoZCwgJ3BlcmZvcm1BY3Rpb25zJyk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgLy8gc2tpcCB0aGUgc3RhbGVuZXNzIGNoZWNrIGZvciB0aGlzIHRlc3RcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKTtcbiAgICAgIGNvbnN0IHBvaW50ZXJNb3ZlQWN0aW9uID0gYWN0aW9uU3R1Yi5hcmdzWzBdWzBdWzBdLmFjdGlvbnNbMF07XG4gICAgICBwb2ludGVyTW92ZUFjdGlvbi54LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueCk7XG4gICAgICBwb2ludGVyTW92ZUFjdGlvbi55LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBmYWxsIGJhY2sgdG8gdG91Y2hhY3Rpb25zIGlmIHczYyBhY3Rpb25zIGRvIG5vdCBleGlzdCBvbiBkcml2ZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGQucGVyZm9ybVRvdWNoID0gXy5ub29wO1xuICAgICAgY29uc3QgYWN0aW9uU3R1YiA9IHNpbm9uLnN0dWIoZCwgJ3BlcmZvcm1Ub3VjaCcpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIC8vIHNraXAgdGhlIHN0YWxlbmVzcyBjaGVjayBmb3IgdGhpcyB0ZXN0XG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCk7XG4gICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25TdHViLmFyZ3NbMF1bMF1bMF0ub3B0aW9ucztcbiAgICAgIGFjdGlvbi54LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueCk7XG4gICAgICBhY3Rpb24ueS5zaG91bGQuZXF1YWwoZWwuY2VudGVyLnkpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdXNlIHRvdWNoYWN0aW9ucyBpZiByZXF1ZXN0ZWQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGQucGVyZm9ybUFjdGlvbnMgPSBfLm5vb3A7XG4gICAgICBjb25zdCB3M2NTdHViID0gc2lub24uc3R1YihkLCAncGVyZm9ybUFjdGlvbnMnKTtcbiAgICAgIGQucGVyZm9ybVRvdWNoID0gXy5ub29wO1xuICAgICAgY29uc3QgdG91Y2hTdHViID0gc2lub24uc3R1YihkLCAncGVyZm9ybVRvdWNoJyk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgLy8gc2tpcCB0aGUgc3RhbGVuZXNzIGNoZWNrIGZvciB0aGlzIHRlc3RcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IGZhbHNlLFxuICAgICAgICBpbWFnZUVsZW1lbnRUYXBTdHJhdGVneTogJ3RvdWNoQWN0aW9ucycsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpO1xuICAgICAgY29uc3QgYWN0aW9uID0gdG91Y2hTdHViLmFyZ3NbMF1bMF1bMF0ub3B0aW9ucztcbiAgICAgIGFjdGlvbi54LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueCk7XG4gICAgICBhY3Rpb24ueS5zaG91bGQuZXF1YWwoZWwuY2VudGVyLnkpO1xuICAgICAgdzNjU3R1Yi5jYWxsQ291bnQuc2hvdWxkLmVxbCgwKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGlmIGRyaXZlciBkb2VzIG5vdCBpbXBsZW1lbnQgYW55IHR5cGUgb2YgYWN0aW9uJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgLy8gc2tpcCB0aGUgc3RhbGVuZXNzIGNoZWNrIGZvciB0aGlzIHRlc3RcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL2RpZCBub3QgaW1wbGVtZW50Lyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcjZXhlY3V0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAvLyBhR0Z3Y0hrZ2RHVnpkR2x1Wnc9PSBpcyAnaGFwcHkgdGVzdGluZydcbiAgICBjb25zdCBpbWdFbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QsIDAsICdhR0Z3Y0hrZ2RHVnpkR2x1Wnc9PScpO1xuICAgIGNvbnN0IGNsaWNrU3R1YiA9IHNpbm9uLnN0dWIoaW1nRWwsICdjbGljaycpO1xuXG4gICAgYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgICAgIGRyaXZlci5faW1nRWxDYWNoZS5zZXQoaW1nRWwuaWQsIGltZ0VsKTtcbiAgICAgIGNsaWNrU3R1Yi5yZXR1cm5zKHRydWUpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgZHJpdmVyLl9pbWdFbENhY2hlLnJlc2V0KCk7XG4gICAgICBjbGlja1N0dWIucmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZXhlY3V0aW9ucyBvbiBlbGVtZW50cyBub3QgaW4gdGhlIGNhY2hlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnY2xpY2snLCAnYXBwaXVtLWltYWdlLWVsZW1lbnQtZm9vJylcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvZWxlbWVudCBjb3VsZCBub3QgYmUgbG9jYXRlZC8pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcmVqZWN0IGV4ZWN1dGlvbnMgZm9yIHVuc3VwcG9ydGVkIGNvbW1hbmRzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZm9vYmFyJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL25vdCB5ZXQgYmVlbiBpbXBsZW1lbnRlZC8pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGRpc3BsYXllZCBzdGF0dXMgb2YgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2VsZW1lbnREaXNwbGF5ZWQnLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnRydWU7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgc2l6ZSBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZ2V0U2l6ZScsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXFsKHt3aWR0aDogZGVmUmVjdC53aWR0aCwgaGVpZ2h0OiBkZWZSZWN0LmhlaWdodH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGxvY2F0aW9uIG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRMb2NhdGlvbicsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXFsKHt4OiBkZWZSZWN0LngsIHk6IGRlZlJlY3QueX0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGxvY2F0aW9uIGluIHZpZXcgb2YgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2dldExvY2F0aW9uJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoe3g6IGRlZlJlY3QueCwgeTogZGVmUmVjdC55fSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgcmVjdCBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZ2V0RWxlbWVudFJlY3QnLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmVxbChkZWZSZWN0KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBzY29yZSBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZ2V0QXR0cmlidXRlJywgaW1nRWwuaWQsICdzY29yZScpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoMCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdmlzdWFsIG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRBdHRyaWJ1dGUnLCBpbWdFbC5pZCwgJ3Zpc3VhbCcpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoJ2FHRndjSGtnZEdWemRHbHVadz09Jyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgbnVsbCBhcyB2aXN1YWwgb2YgZWxlbWVudCBieSBkZWZhdWx0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgaW1nRWxlbWVudCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgZHJpdmVyLl9pbWdFbENhY2hlLnNldChpbWdFbGVtZW50LmlkLCBpbWdFbGVtZW50KTtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2dldEF0dHJpYnV0ZScsIGltZ0VsZW1lbnQuaWQsICd2aXN1YWwnKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXFsKG51bGwpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbm90IGdldCBvdGhlciBhdHRyaWJ1dGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRBdHRyaWJ1dGUnLCBpbWdFbC5pZCwgJ2NvbnRlbnQtZGVzYycpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5yZWplY3RlZFdpdGgoJ01ldGhvZCBoYXMgbm90IHlldCBiZWVuIGltcGxlbWVudGVkJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBjbGljayBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnY2xpY2snLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdpbWFnZSBlbGVtZW50IExSVSBjYWNoZScsIGZ1bmN0aW9uICgpIHtcbiAgaXQoJ3Nob3VsZCBhY2NlcHQgYW5kIGNhY2hlIGltYWdlIGVsZW1lbnRzJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGVsMSA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGVsMiA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGNhY2hlID0gbWFrZUltYWdlRWxlbWVudENhY2hlKCk7XG4gICAgY2FjaGUuc2V0KGVsMS5pZCwgZWwxKTtcbiAgICBlbDEuZXF1YWxzKGNhY2hlLmdldChlbDEuaWQpKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBfLmlzVW5kZWZpbmVkKGNhY2hlLmdldChlbDIuaWQpKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5oYXMoZWwxLmlkKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5oYXMoZWwyLmlkKS5zaG91bGQuYmUuZmFsc2U7XG4gIH0pO1xuICBpdCgnb25jZSBjYWNoZSByZWFjaGVzIG1heCBzaXplLCBzaG91bGQgZWplY3QgaW1hZ2UgZWxlbWVudHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgZWwxID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgY29uc3QgZWwyID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgY29uc3QgY2FjaGUgPSBtYWtlSW1hZ2VFbGVtZW50Q2FjaGUoZGVmVGVtcGxhdGUubGVuZ3RoICsgMSk7XG4gICAgY2FjaGUuc2V0KGVsMS5pZCwgZWwxKTtcbiAgICBjYWNoZS5oYXMoZWwxLmlkKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5zZXQoZWwyLmlkLCBlbDIpO1xuICAgIGNhY2hlLmhhcyhlbDIuaWQpLnNob3VsZC5iZS50cnVlO1xuICAgIGNhY2hlLmhhcyhlbDEuaWQpLnNob3VsZC5iZS5mYWxzZTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ2dldEltZ0VsRnJvbUFyZ3MnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBpbWFnZSBlbGVtZW50IGlkIGZyb20ganNvbiBvYmogaW4gYXJncycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBpbWdFbCA9IGAke0lNQUdFX0VMRU1FTlRfUFJFRklYfWZvb2A7XG4gICAgY29uc3QgYXJncyA9IFsxLCAnZm9vJywgaW1nRWxdO1xuICAgIGdldEltZ0VsRnJvbUFyZ3MoYXJncykuc2hvdWxkLmVxbChpbWdFbCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIG5vdCByZXR1cm4gYW55dGhpbmcgaWYgaW1hZ2UgZWxlbWVudCBpZCBub3QgaW4gYXJncycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBhcmdzID0gWzEsICdmb28nXTtcbiAgICBfLmlzVW5kZWZpbmVkKGdldEltZ0VsRnJvbUFyZ3MoYXJncykpLnNob3VsZC5iZS50cnVlO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBub3QgZmluZCBpbWFnZSBlbGVtZW50IGlkIGluIGFueXRoaW5nIGJ1dCBwcmVmaXgnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgbm90SW1nRWwgPSBgZm9vJHtJTUFHRV9FTEVNRU5UX1BSRUZJWH1gO1xuICAgIGNvbnN0IGFyZ3MgPSBbMSwgJ2ZvbycsIG5vdEltZ0VsXTtcbiAgICBfLmlzVW5kZWZpbmVkKGdldEltZ0VsRnJvbUFyZ3MoYXJncykpLnNob3VsZC5iZS50cnVlO1xuICB9KTtcbn0pO1xuIl0sImZpbGUiOiJ0ZXN0L2Jhc2Vkcml2ZXIvaW1hZ2UtZWxlbWVudC1zcGVjcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
